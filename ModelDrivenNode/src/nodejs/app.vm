// Do my imports
var express = require('express');  
var app = express();

var server = require('http').createServer(app);
var config = require('./config.js')(app, express);
var moment = require('moment');


// Set up database connections
var mongoose = require('mongoose');

if (process.env.SUBDOMAIN){
  mongoose.connect('mongodb://nodejitsu:605daa1951a29d5eac3c9f48eed44cc1@paulo.mongohq.com:10042/nodejitsudb6660047036');
} else {
  mongoose.connect('mongodb://localhost/${schema}');
}

//mongoose.connect('mongodb://nodejitsu_broward:jtsh6nbljs17ol4u6feaqggv1m@ds039267.mongolab.com:39267/nodejitsu_broward_nodejitsudb11381402');

console.log('db connected');

// Set up models
var models = {};
models = require('./${version}/models/models')(mongoose);
require('./${version}/models/testdata1')(mongoose, models, moment);
require('./${version}/routes/routes')(app, mongoose, models);


// Set up queues
var kue = require('./${version}/queues/kue')(models);


// Entry pages
app.get('/', function(req, res){
  res.render('index.jade', {
    title: 'Model-Driven Node: Reference Implementation'
  });
});

// Schema Entry page
app.get('/${version}', function(req, res){
  res.render('index', {
    title: 'Model-Driven Node: Reference Implementation'
  });
});

// API demo page
app.get('/${urlRoot}/Api', function(req, res){
  res.render('api.jade', {
    titleGet: 'REST GET API',
    titlePost: 'REST POST API',
    apisget: app.routes.get,
    apispost: app.routes.post
  });
});

console.log('app loaded!');
app.listen(process.env.PORT || 3000);
